#!/bin/bash

# Переход в корень проекта, относительно расположения скрипта
cd "$(dirname "$0")/../.." || { echo "Не удалось перейти в корень проекта."; return 1; }

# Проверка наличия pom.xml для уверенности
if [ ! -f "pom.xml" ]; then
  echo "Файл 'pom.xml' не найден. Это не корень Maven-проекта."
  return 1
fi

# Получение свежих изменений
echo "Получение свежих изменений из репозитория..."
git pull || { echo "Ошибка при получении обновлений."; return 1; }

# Проверка, нужно ли выполнять mvn clean
if [ -d "target" ]; then
  echo "Папка 'target' уже существует."
  read -p "Выполнить 'mvn clean'? (y/n): " answer
  if [[ "$answer" =~ ^[Yy]$ ]]; then
    echo "Выполняется очистка проекта..."
    mvn clean || { echo "Ошибка при очистке проекта."; return 1; }
  else
    echo "Остановка по запросу пользователя."
    return 0
  fi
fi

# Сборка проекта
echo "Запускается компиляция проекта..."
mvn compile || { echo "Ошибка при компиляции проекта."; return 1; }

echo "Упаковка проекта..."
mvn package || { echo "Ошибка при упаковке проекта."; return 1; }

echo "Проект успешно упакован"
